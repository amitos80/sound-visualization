{"version":3,"sources":["../src/fluid-animation.js"],"names":["defaultConfig","textureDownsample","densityDissipation","velocityDissipation","pressureDissipation","pressureIterations","curl","splatRadius","Pointer","id","x","y","dx","dy","down","moved","color","FluidAnimation","opts","e","_pointers","offsetX","offsetY","Math","random","i","touches","length","touch","clientX","clientY","destination","gl","_gl","bindFramebuffer","FRAMEBUFFER","drawElements","TRIANGLES","UNSIGNED_SHORT","canvas","config","_canvas","_config","_splatStack","ext","_ext","_initPrograms","_initBlit","resize","_time","Date","now","_timer","splat","push","splats","Array","isArray","count","_getRandomSplat","addSplats","width","height","_width","_height","_initFramebuffers","_programs","clear","GLProgram","shaders","vert","display","advection","supportLinearFiltering","advectionManualFiltering","divergence","vorticity","pressure","gradientSubtract","createFBO","texId","w","h","internalFormat","format","type","param","activeTexture","TEXTURE0","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","framebufferTexture2D","COLOR_ATTACHMENT0","viewport","COLOR_BUFFER_BIT","createDoubleFBO","fbo1","fbo2","read","write","swap","temp","_textureWidth","drawingBufferWidth","_textureHeight","drawingBufferHeight","texType","halfFloatTexType","rgba","formatRGBA","rg","formatRG","r","formatR","_density","LINEAR","NEAREST","_velocity","_divergence","_curl","_pressure","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","vertexAttribPointer","FLOAT","enableVertexAttribArray","bind","uniform1i","uniforms","uTarget","uniform1f","aspectRatio","uniform2f","point","uniform3f","radius","_blit","undefined","_splat","_addSplat","dt","min","iW","iH","_addSplats","pop","texelSize","uVelocity","uSource","dissipation","pointer","uCurl","pressureTexId","uTexture","value","uDivergence","uPressure"],"mappings":"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","sourcesContent":["import GLProgram from './gl-program'\nimport getGLContext from './get-gl-context'\n\nimport shaders from './shaders'\n\nexport const defaultConfig = {\n  textureDownsample: 1,\n  densityDissipation: 0.98,\n  velocityDissipation: 0.99,\n  pressureDissipation: 0.8,\n  pressureIterations: 25,\n  curl: 30,\n  splatRadius: 0.005\n}\n\nclass Pointer {\n  constructor() {\n    this.id = -1\n    this.x = 0\n    this.y = 0\n    this.dx = 0\n    this.dy = 0\n    this.down = false\n    this.moved = false\n    this.color = [30, 0, 300]\n  }\n}\n\nexport default class FluidAnimation {\n  constructor(opts) {\n    const {\n      canvas,\n      config = {\n        ...defaultConfig,\n        ...opts.config\n      }\n    } = opts\n\n    this._canvas = canvas\n    this._config = config\n\n    this._pointers = [ new Pointer() ]\n    this._splatStack = []\n\n    const { gl, ext } = getGLContext(canvas)\n    this._gl = gl\n    this._ext = ext\n\n    this._initPrograms()\n    this._initBlit()\n    this.resize()\n\n    this._time = Date.now()\n    this._timer = 0\n  }\n\n  get config() {\n    return this._config\n  }\n\n  set config(config) {\n    this._config = config\n  }\n\n  get width() {\n    return this._canvas.width\n  }\n\n  get height() {\n    return this._canvas.height\n  }\n\n  addSplat(splat) {\n    this._splatStack.push([ splat ])\n  }\n\n  addSplats(splats) {\n    this._splatStack.push(Array.isArray(splats) ? splats : [ splats ])\n  }\n\n  addRandomSplats(count) {\n    const splats = []\n\n    for (let i = 0; i < count; ++i) {\n      splats.push(this._getRandomSplat())\n    }\n\n    this.addSplats(splats)\n  }\n\n  resize() {\n    const {\n      width,\n      height\n    } = this._canvas\n\n    if (this._width !== width || this._height !== height) {\n      this._width = width\n      this._height = height\n\n      this._initFramebuffers()\n    }\n  }\n\n  onMouseMove = (e) => {\n    this._pointers[0].moved = this._pointers[0].down\n    this._pointers[0].dx = (e.offsetX - this._pointers[0].x) * 10.0\n    this._pointers[0].dy = (e.offsetY - this._pointers[0].y) * 10.0\n    this._pointers[0].x = e.offsetX\n    this._pointers[0].y = e.offsetY\n  }\n\n  onMouseDown = (e) => {\n    this._pointers[0].down = true\n    this._pointers[0].color = [\n      Math.random() + 0.2,\n      Math.random() + 0.2,\n      Math.random() + 0.2\n    ]\n  }\n\n  onMouseUp = (e) => {\n    this._pointers[0].down = false\n  }\n\n  onTouchStart = (e) => {\n    for (let i = 0; i < e.touches.length; ++i) {\n      this._pointers[i].down = true\n      this._pointers[i].color = [\n        Math.random() + 0.2,\n        Math.random() + 0.2,\n        Math.random() + 0.2\n      ]\n    }\n  }\n\n  onTouchMove = (e) => {\n    for (let i = 0; i < e.touches.length; ++i) {\n      const touch = e.touches[i]\n      this._pointers[i].moved = this._pointers[i].down\n      this._pointers[i].dx = (touch.clientX - this._pointers[i].x) * 10.0\n      this._pointers[i].dy = (touch.clientY - this._pointers[i].y) * 10.0\n      this._pointers[i].x = touch.clientX\n      this._pointers[i].y = touch.clientY\n    }\n  }\n\n  onTouchEnd = (e) => {\n    for (let i = 0; i < e.touches.length; ++i) {\n      this._pointers[i].down = false\n    }\n  }\n\n  _initPrograms() {\n    const gl = this._gl\n    const ext = this._ext\n\n    this._programs = { }\n    this._programs.clear = new GLProgram(gl, shaders.vert, shaders.clear)\n    this._programs.display = new GLProgram(gl, shaders.vert, shaders.display)\n    this._programs.splat = new GLProgram(gl, shaders.vert, shaders.splat)\n    this._programs.advection = new GLProgram(gl, shaders.vert, ext.supportLinearFiltering\n      ? shaders.advection\n      : shaders.advectionManualFiltering\n    )\n    this._programs.divergence = new GLProgram(gl, shaders.vert, shaders.divergence)\n    this._programs.curl = new GLProgram(gl, shaders.vert, shaders.curl)\n    this._programs.vorticity = new GLProgram(gl, shaders.vert, shaders.vorticity)\n    this._programs.pressure = new GLProgram(gl, shaders.vert, shaders.pressure)\n    this._programs.gradientSubtract = new GLProgram(gl, shaders.vert, shaders.gradientSubtract)\n  }\n\n  _initFramebuffers() {\n    const gl = this._gl\n    const ext = this._ext\n\n    function createFBO(texId, w, h, internalFormat, format, type, param) {\n      gl.activeTexture(gl.TEXTURE0 + texId)\n      const texture = gl.createTexture()\n      gl.bindTexture(gl.TEXTURE_2D, texture)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n      gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, w, h, 0, format, type, null)\n\n      const fbo = gl.createFramebuffer()\n      gl.bindFramebuffer(gl.FRAMEBUFFER, fbo)\n      gl.framebufferTexture2D(\n        gl.FRAMEBUFFER,\n        gl.COLOR_ATTACHMENT0,\n        gl.TEXTURE_2D,\n        texture,\n        0\n      )\n      gl.viewport(0, 0, w, h)\n      gl.clear(gl.COLOR_BUFFER_BIT)\n\n      return [texture, fbo, texId]\n    }\n\n    function createDoubleFBO(texId, w, h, internalFormat, format, type, param) {\n      let fbo1 = createFBO(texId, w, h, internalFormat, format, type, param)\n      let fbo2 = createFBO(texId + 1, w, h, internalFormat, format, type, param)\n\n      return {\n        get read() {\n          return fbo1\n        },\n        get write() {\n          return fbo2\n        },\n        swap() {\n          const temp = fbo1\n          fbo1 = fbo2\n          fbo2 = temp\n        }\n      }\n    }\n\n    this._textureWidth = gl.drawingBufferWidth >> this._config.textureDownsample\n    this._textureHeight = gl.drawingBufferHeight >> this._config.textureDownsample\n\n    const texType = ext.halfFloatTexType\n    const rgba = ext.formatRGBA\n    const rg = ext.formatRG\n    const r = ext.formatR\n\n    this._density = createDoubleFBO(\n      2,\n      this._textureWidth,\n      this._textureHeight,\n      rgba.internalFormat,\n      rgba.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    )\n\n    this._velocity = createDoubleFBO(\n      0,\n      this._textureWidth,\n      this._textureHeight,\n      rg.internalFormat,\n      rg.format,\n      texType,\n      ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n    )\n\n    this._divergence = createFBO(\n      4,\n      this._textureWidth,\n      this._textureHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n\n    this._curl = createFBO(\n      5,\n      this._textureWidth,\n      this._textureHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n\n    this._pressure = createDoubleFBO(\n      6,\n      this._textureWidth,\n      this._textureHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n  }\n\n  _initBlit() {\n    const gl = this._gl\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer())\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]), gl.STATIC_DRAW)\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer())\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array([0, 1, 2, 0, 2, 3]), gl.STATIC_DRAW)\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(0)\n  }\n\n  _blit = (destination) => {\n    const gl = this._gl\n    gl.bindFramebuffer(gl.FRAMEBUFFER, destination)\n    gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0)\n  }\n\n  _splat(x, y, dx, dy, color) {\n    const gl = this._gl\n\n    this._programs.splat.bind()\n    gl.uniform1i(this._programs.splat.uniforms.uTarget, this._velocity.read[2])\n    gl.uniform1f(this._programs.splat.uniforms.aspectRatio, this._canvas.width / this._canvas.height)\n    gl.uniform2f(this._programs.splat.uniforms.point, x / this._canvas.width, 1.0 - y / this._canvas.height)\n    gl.uniform3f(this._programs.splat.uniforms.color, dx, -dy, 1.0)\n    gl.uniform1f(this._programs.splat.uniforms.radius, this._config.splatRadius)\n    this._blit(this._velocity.write[1])\n    this._velocity.swap()\n\n    gl.uniform1i(this._programs.splat.uniforms.uTarget, this._density.read[2])\n    gl.uniform3f(this._programs.splat.uniforms.color, color[0] * 0.3, color[1] * 0.3, color[2] * 0.3)\n    this._blit(this._density.write[1])\n    this._density.swap()\n  }\n\n  _addSplat(splat) {\n    const { x, y, dx, dy, color } = splat\n\n    if (x === undefined) return\n    if (y === undefined) return\n    if (dx === undefined) return\n    if (dy === undefined) return\n    if (color === undefined) return\n\n    this._splat(x, y, dx, dy, color)\n  }\n\n  _addSplats(splats) {\n    for (const splat of splats) {\n      this._addSplat(splat)\n    }\n  }\n\n  _getRandomSplat() {\n    const color = [ Math.random() * 10, Math.random() * 10, Math.random() * 10 ]\n    const x = this._canvas.width * Math.random()\n    const y = this._canvas.height * Math.random()\n    const dx = 1000 * (Math.random() - 0.5)\n    const dy = 1000 * (Math.random() - 0.5)\n\n    return { x, y, dx, dy, color }\n  }\n\n  update() {\n    const gl = this._gl\n\n    const dt = Math.min((Date.now() - this._time) / 1000, 0.016)\n    this._time = Date.now()\n    this._timer += 0.0001\n\n    const w = this._textureWidth\n    const h = this._textureHeight\n    const iW = 1.0 / w\n    const iH = 1.0 / h\n\n    gl.viewport(0, 0, w, h)\n\n    if (this._splatStack.length > 0) {\n      this._addSplats(this._splatStack.pop())\n    }\n\n    this._programs.advection.bind()\n    gl.uniform2f(this._programs.advection.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.advection.uniforms.uVelocity, this._velocity.read[2])\n    gl.uniform1i(this._programs.advection.uniforms.uSource, this._velocity.read[2])\n    gl.uniform1f(this._programs.advection.uniforms.dt, dt)\n    gl.uniform1f(\n      this._programs.advection.uniforms.dissipation,\n      this._config.velocityDissipation\n    )\n    this._blit(this._velocity.write[1])\n    this._velocity.swap()\n\n    gl.uniform1i(this._programs.advection.uniforms.uVelocity, this._velocity.read[2])\n    gl.uniform1i(this._programs.advection.uniforms.uSource, this._density.read[2])\n    gl.uniform1f(\n      this._programs.advection.uniforms.dissipation,\n      this._config.densityDissipation\n    )\n    this._blit(this._density.write[1])\n    this._density.swap()\n\n    for (let i = 0; i < this._pointers.length; i++) {\n      const pointer = this._pointers[i]\n      if (pointer.moved) {\n        this._splat(pointer.x, pointer.y, pointer.dx, pointer.dy, pointer.color)\n        pointer.moved = false\n      }\n    }\n\n    this._programs.curl.bind()\n    gl.uniform2f(this._programs.curl.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.curl.uniforms.uVelocity, this._velocity.read[2])\n    this._blit(this._curl[1])\n\n    this._programs.vorticity.bind()\n    gl.uniform2f(this._programs.vorticity.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.vorticity.uniforms.uVelocity, this._velocity.read[2])\n    gl.uniform1i(this._programs.vorticity.uniforms.uCurl, this._curl[2])\n    gl.uniform1f(this._programs.vorticity.uniforms.curl, this._config.curl)\n    gl.uniform1f(this._programs.vorticity.uniforms.dt, dt)\n    this._blit(this._velocity.write[1])\n    this._velocity.swap()\n\n    this._programs.divergence.bind()\n    gl.uniform2f(this._programs.divergence.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.divergence.uniforms.uVelocity, this._velocity.read[2])\n    this._blit(this._divergence[1])\n\n    this._programs.clear.bind()\n    let pressureTexId = this._pressure.read[2]\n    gl.activeTexture(gl.TEXTURE0 + pressureTexId)\n    gl.bindTexture(gl.TEXTURE_2D, this._pressure.read[0])\n    gl.uniform1i(this._programs.clear.uniforms.uTexture, pressureTexId)\n    gl.uniform1f(this._programs.clear.uniforms.value, this._config.pressureDissipation)\n    this._blit(this._pressure.write[1])\n    this._pressure.swap()\n\n    this._programs.pressure.bind()\n    gl.uniform2f(this._programs.pressure.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.pressure.uniforms.uDivergence, this._divergence[2])\n    pressureTexId = this._pressure.read[2]\n    gl.uniform1i(this._programs.pressure.uniforms.uPressure, pressureTexId)\n    gl.activeTexture(gl.TEXTURE0 + pressureTexId)\n    for (let i = 0; i < this._config.pressureIterations; i++) {\n      gl.bindTexture(gl.TEXTURE_2D, this._pressure.read[0])\n      this._blit(this._pressure.write[1])\n      this._pressure.swap()\n    }\n\n    this._programs.gradientSubtract.bind()\n    gl.uniform2f(this._programs.gradientSubtract.uniforms.texelSize, iW, iH)\n    gl.uniform1i(this._programs.gradientSubtract.uniforms.uPressure, this._pressure.read[2])\n    gl.uniform1i(this._programs.gradientSubtract.uniforms.uVelocity, this._velocity.read[2])\n    this._blit(this._velocity.write[1])\n    this._velocity.swap()\n\n    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight)\n    this._programs.display.bind()\n    gl.uniform1i(this._programs.display.uniforms.uTexture, this._density.read[2])\n    this._blit(null)\n  }\n}\n"],"file":"fluid-animation.js"}
{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/amit/Projects/sound-visualization/client/pages/index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useLayoutEffect } from 'react';\nimport FluidAnimation from 'react-fluid-animation'; //import {ToastContainer, toast} from 'react-toastify'\n\nimport Wave from '../utils/wave-visualizer';\nimport { take, fill, sum, floor } from 'lodash';\nimport { PlayerService } from '../utils/grpc-client/services';\nimport { ClientMessage, ServerMessage } from '../proto/player_pb';\nvar COMPRESSION_FACTOR = 8;\n\nvar randomWhole = function randomWhole(min, max) {\n  return Math.floor(Math.random() * (max - min) + min);\n};\n\nvar randomReal = function randomReal(min, max) {\n  return Math.random() * (max - min) + min;\n};\n\nvar defaultConfig = {\n  textureDownsample: 2,\n  densityDissipation: 0.9,\n  velocityDissipation: 0.91,\n  pressureDissipation: 1,\n  pressureIterations: 44,\n  curl: 0,\n  splatRadius: 0.0057\n};\nvar baseConfigs = [{\n  textureDownsample: 1,\n  densityDissipation: 0.98,\n  velocityDissipation: 0.99,\n  pressureDissipation: 0.8,\n  pressureIterations: 25,\n  curl: 30,\n  splatRadius: 0.005\n}, {\n  textureDownsample: 2,\n  densityDissipation: 0.9,\n  velocityDissipation: 0.91,\n  pressureDissipation: 1,\n  pressureIterations: 44,\n  curl: 0,\n  splatRadius: 0.0057\n}, {\n  textureDownsample: 0,\n  densityDissipation: 0.92,\n  velocityDissipation: 0.95,\n  pressureDissipation: 0.8,\n  pressureIterations: 10,\n  curl: 20,\n  splatRadius: 0.01\n}, {\n  textureDownsample: 1,\n  densityDissipation: 0.98,\n  velocityDissipation: 0.99,\n  pressureDissipation: 0.998,\n  pressureIterations: 19,\n  curl: 8,\n  splatRadius: 0.008\n}];\n\nfunction rect(_ref) {\n  var id = _ref.id,\n      x = _ref.x,\n      y = _ref.y,\n      width = _ref.width,\n      height = _ref.height,\n      _ref$fill = _ref.fill,\n      fill = _ref$fill === void 0 ? 'gray' : _ref$fill,\n      _ref$stroke = _ref.stroke,\n      stroke = _ref$stroke === void 0 ? 'skyblue' : _ref$stroke,\n      _ref$strokewidth = _ref.strokewidth,\n      strokewidth = _ref$strokewidth === void 0 ? 2 : _ref$strokewidth;\n  return {\n    x: x,\n    y: y,\n    id: id,\n    width: width,\n    height: height,\n    fill: fill,\n    stroke: stroke,\n    strokewidth: strokewidth\n  };\n}\n\nvar factor = 0.1;\nvar joined = false;\nexport var Home = function Home(props) {\n  _s();\n\n  var _useState = useState(0),\n      selectedIndex = _useState[0],\n      setSelectedIndex = _useState[1];\n\n  var _useState2 = useState(0),\n      frameNumber = _useState2[0],\n      setFrameNumber = _useState2[1];\n\n  var _useState3 = useState(baseConfigs),\n      animationConfig = _useState3[0],\n      setAnimationConfig = _useState3[1];\n\n  var _useState4 = useState(defaultConfig),\n      currentConfig = _useState4[0],\n      setCurrentConfig = _useState4[1];\n\n  var _useState5 = useState(),\n      startInterval = _useState5[0],\n      setStartInterval = _useState5[1];\n\n  var myRef = /*#__PURE__*/React.createRef();\n\n  var _useState6 = useState({}),\n      wave = _useState6[0],\n      setWave = _useState6[1];\n\n  var changeStyle = function changeStyle() {\n    var newIndex = selectedIndex + 1 > configs.length - 1 ? 0 : selectedIndex + 1;\n    setSelectedIndex(newIndex); //toast('style changed');\n  };\n\n  var randomStyle = function randomStyle() {\n    var configs = _toConsumableArray(animationConfig || []);\n\n    configs.push({\n      textureDownsample: randomWhole(1, 3),\n      densityDissipation: randomReal(0.9, 0.99),\n      velocityDissipation: randomReal(0.9, 0.99),\n      pressureDissipation: randomReal(0.1, 0.9),\n      pressureIterations: randomWhole(1, 61),\n      curl: randomWhole(15, 35),\n      splatRadius: randomReal(0.003, 0.007)\n    });\n    var newIndex = configs.length - 1;\n    setSelectedIndex(newIndex);\n    setAnimationConfig(configs); //toast('random style');\n  };\n\n  var createSampleAnimation = function createSampleAnimation() {\n    var _wave$current_stream, _wave$current_stream$, _wave$current_stream2;\n\n    if (!(wave !== null && wave !== void 0 && (_wave$current_stream = wave.current_stream) !== null && _wave$current_stream !== void 0 && (_wave$current_stream$ = _wave$current_stream.data) !== null && _wave$current_stream$ !== void 0 && _wave$current_stream$.length)) return;\n    var samples = Array.from(wave === null || wave === void 0 ? void 0 : (_wave$current_stream2 = wave.current_stream) === null || _wave$current_stream2 === void 0 ? void 0 : _wave$current_stream2.data);\n    var a1 = samples.splice(0, 50);\n    var a2 = samples.splice(51, 70);\n    var a3 = samples.splice(71, 110);\n    var a4 = samples.splice(111, 333); // const pctValue1 = (sum(a1) / a1.length) / 160 // bass / gain\n    // const pctValue2 = (sum(a2) / a2.length) / 150\n    // const pctValue3 = (sum(a3) / a3.length) / 210\n    // const pctValue4 = (sum(a4) / a4.length ) / 450\n    //console.log(' pctValue1 ', pctValue1, ' pctValue2 ', pctValue2, ' pctValue3 ', pctValue3, ' pctValue4 ', pctValue4 )\n\n    var a = sum(a1) / a1.length / 160; // bass / gain\n\n    var b = sum(a2) / a2.length / 150;\n    var c = sum(a3) / a3.length / 210;\n    var d = sum(a4) / a4.length / 450; //playerService.pointBit({a, b, c, d})\n\n    if (PlayerService) {\n      var clientMessage = new ClientMessage();\n      clientMessage.setA(a);\n      clientMessage.setB(b);\n      clientMessage.setC(c);\n      clientMessage.setD(d);\n      PlayerService.send(clientMessage);\n    }\n  };\n\n  var createNewConfig = function createNewConfig() {\n    var sample = fill(Array(COMPRESSION_FACTOR), 0).map(function (value, i) {\n      var _wave$current_stream3, _wave$current_stream4, _wave$current_stream5;\n\n      var sampleLength = wave === null || wave === void 0 ? void 0 : (_wave$current_stream3 = wave.current_stream) === null || _wave$current_stream3 === void 0 ? void 0 : (_wave$current_stream4 = _wave$current_stream3.data) === null || _wave$current_stream4 === void 0 ? void 0 : _wave$current_stream4.length;\n      if (!sampleLength) return 0;\n      var samples = Array.from(wave === null || wave === void 0 ? void 0 : (_wave$current_stream5 = wave.current_stream) === null || _wave$current_stream5 === void 0 ? void 0 : _wave$current_stream5.data);\n      var blockSize = sampleLength / COMPRESSION_FACTOR;\n      return sum(take(samples, floor(i * blockSize, floor(blockSize * (i + 1))))) || 0;\n    });\n    setCurrentConfig({\n      textureDownsample: 1,\n      densityDissipation: sample[0] / 154,\n      // 0.98,\n      velocityDissipation: sample[1] / 151,\n      ///0.99,\n      pressureDissipation: sample[2] / 110,\n      // 0.998,\n      pressureIterations: sample[3] / 23,\n      // 19,\n      curl: sample[4] / 11,\n      // 8,\n      splatRadius: 0.008\n    });\n  };\n\n  useEffect(function () {\n    if (true && !joined && !PlayerService) {\n      joined = true;\n      PlayerService.join();\n    }\n\n    if (true) {\n      navigator.mediaDevices.getUserMedia({\n        audio: true\n      }).then(function (stream) {\n        var wave = new Wave();\n        wave.fromStream(stream, 'visual-canvas', {\n          type: 'shine',\n          colors: ['red', 'white', 'blue']\n        });\n        setWave(wave);\n        setInterval(createSampleAnimation, 180);\n      })[\"catch\"](function (err) {\n        console.log(err.message);\n      });\n    }\n  }, []);\n  if (!wave) return __jsx(\"div\", {\n    style: {\n      width: '100%',\n      height: '100vh',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  });\n  return __jsx(\"div\", {\n    style: {\n      width: '100%',\n      height: '100vh',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }\n  }, true && __jsx(\"script\", {\n    src: \"https://cdn.jsdelivr.net/gh/foobar404/wave.js/dist/bundle.iife.js\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 43\n    }\n  }), __jsx(FluidAnimation, {\n    ref: function ref(element) {\n      return myRef = element;\n    },\n    className: \"anim\",\n    config: currentConfig,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }));\n}; //<div draggable=\"true\" className=\"pointb\" style={{zIndex: 0, position: 'absolute', background: 'red', top: '200px', left: '90px', width: '50px', height: '50px' }} />\n\n_s(Home, \"WPjp4joHBpxg7724DjIqpdSvOww=\");\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/Users/amit/Projects/sound-visualization/client/pages/index.js"],"names":["React","useState","useEffect","useLayoutEffect","FluidAnimation","Wave","take","fill","sum","floor","PlayerService","ClientMessage","ServerMessage","COMPRESSION_FACTOR","randomWhole","min","max","Math","random","randomReal","defaultConfig","textureDownsample","densityDissipation","velocityDissipation","pressureDissipation","pressureIterations","curl","splatRadius","baseConfigs","rect","id","x","y","width","height","stroke","strokewidth","factor","joined","Home","props","selectedIndex","setSelectedIndex","frameNumber","setFrameNumber","animationConfig","setAnimationConfig","currentConfig","setCurrentConfig","startInterval","setStartInterval","myRef","createRef","wave","setWave","changeStyle","newIndex","configs","length","randomStyle","push","createSampleAnimation","current_stream","data","samples","Array","from","a1","splice","a2","a3","a4","a","b","c","d","clientMessage","setA","setB","setC","setD","send","createNewConfig","sample","map","value","i","sampleLength","blockSize","join","navigator","mediaDevices","getUserMedia","audio","then","stream","fromStream","type","colors","setInterval","err","console","log","message","display","justifyContent","alignItems","element"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useLayoutEffect} from 'react'\nimport FluidAnimation from 'react-fluid-animation'\n//import {ToastContainer, toast} from 'react-toastify'\nimport Wave from '../utils/wave-visualizer'\nimport { take, fill, sum, floor } from 'lodash'\nimport { PlayerService } from '../utils/grpc-client/services'\nimport { ClientMessage, ServerMessage } from '../proto/player_pb';\nconst COMPRESSION_FACTOR = 8\n\nconst randomWhole = (min, max) => Math.floor(Math.random() * (max - min) + min)\nconst randomReal = (min, max) => Math.random() * (max - min) + min\n\nconst defaultConfig =   {\n    textureDownsample: 2,\n    densityDissipation: 0.9,\n    velocityDissipation: 0.91,\n    pressureDissipation: 1,\n    pressureIterations: 44,\n    curl: 0,\n    splatRadius: 0.0057,\n}\n\nconst baseConfigs = [\n  {\n    textureDownsample: 1,\n    densityDissipation: 0.98,\n    velocityDissipation: 0.99,\n    pressureDissipation: 0.8,\n    pressureIterations: 25,\n    curl: 30,\n    splatRadius: 0.005,\n  },\n  {\n    textureDownsample: 2,\n    densityDissipation: 0.9,\n    velocityDissipation: 0.91,\n    pressureDissipation: 1,\n    pressureIterations: 44,\n    curl: 0,\n    splatRadius: 0.0057,\n  },\n  {\n    textureDownsample: 0,\n    densityDissipation: 0.92,\n    velocityDissipation: 0.95,\n    pressureDissipation: 0.8,\n    pressureIterations: 10,\n    curl: 20,\n    splatRadius: 0.01,\n  },\n  {\n    textureDownsample: 1,\n    densityDissipation: 0.98,\n    velocityDissipation: 0.99,\n    pressureDissipation: 0.998,\n    pressureIterations: 19,\n    curl: 8,\n    splatRadius: 0.008,\n  },\n]\n\nfunction rect({id, x, y, width, height, fill = 'gray', stroke = 'skyblue', strokewidth = 2}) {\n    return {\n        x, y, id, width, height, fill, stroke, strokewidth,\n    }\n}\n\nlet factor = 0.1\nlet joined = false\nexport const Home = (props) => {\n  const [selectedIndex, setSelectedIndex] = useState(0)\n  const [frameNumber, setFrameNumber] = useState(0)\n  const [animationConfig, setAnimationConfig] = useState(baseConfigs)\n  const [currentConfig, setCurrentConfig] = useState(defaultConfig)\n    const [startInterval, setStartInterval] = useState()\n  let myRef = React.createRef();\n  let [wave, setWave] = useState({})\n\n  const changeStyle = () => {\n      const newIndex = selectedIndex + 1 > configs.length -1 ? 0 : selectedIndex + 1;\n        setSelectedIndex(\n          newIndex\n       )\n\n      //toast('style changed');\n  }\n\n  const randomStyle = () => {\n    const configs = [...(animationConfig || [])]\n    configs.push({\n        textureDownsample: randomWhole(1, 3),\n        densityDissipation: randomReal(0.9, 0.99),\n        velocityDissipation: randomReal(0.9, 0.99),\n        pressureDissipation: randomReal(0.1, 0.9),\n        pressureIterations: randomWhole(1, 61),\n        curl: randomWhole(15, 35),\n        splatRadius: randomReal(0.003, 0.007),\n    })\n    const newIndex = configs.length -1;\n    setSelectedIndex(\n        newIndex\n    )\n    setAnimationConfig(configs)\n    //toast('random style');\n  }\n\n  const createSampleAnimation = () => {\n      if (!wave?.current_stream?.data?.length) return\n\n      const samples = Array.from(wave?.current_stream?.data)\n      const a1 = samples.splice(0, 50)\n      const a2 = samples.splice( 51, 70)\n      const a3 = samples.splice( 71, 110)\n      const a4 = samples.splice( 111, 333)\n\n      // const pctValue1 = (sum(a1) / a1.length) / 160 // bass / gain\n      // const pctValue2 = (sum(a2) / a2.length) / 150\n      // const pctValue3 = (sum(a3) / a3.length) / 210\n      // const pctValue4 = (sum(a4) / a4.length ) / 450\n      //console.log(' pctValue1 ', pctValue1, ' pctValue2 ', pctValue2, ' pctValue3 ', pctValue3, ' pctValue4 ', pctValue4 )\n\n       const a = (sum(a1) / a1.length) / 160 // bass / gain\n       const b = (sum(a2) / a2.length) / 150\n       const c = (sum(a3) / a3.length) / 210\n       const d = (sum(a4) / a4.length ) / 450\n      //playerService.pointBit({a, b, c, d})\n      if (PlayerService) {\n          const clientMessage = new ClientMessage();\n          clientMessage.setA(a)\n          clientMessage.setB(b)\n          clientMessage.setC(c)\n          clientMessage.setD(d)\n          PlayerService.send(clientMessage)\n      }\n  }\n\n  const createNewConfig = () => {\n      let sample = fill(Array(COMPRESSION_FACTOR), 0).map((value, i) => {\n          const sampleLength = wave?.current_stream?.data?.length\n          if (!sampleLength) return 0\n          const samples = Array.from(wave?.current_stream?.data)\n          const blockSize = sampleLength / COMPRESSION_FACTOR\n          return sum(take(samples,\n              floor(i * blockSize,\n                  floor(blockSize * (i + 1))))\n          ) || 0\n      })\n\n      setCurrentConfig({\n          textureDownsample: 1,\n          densityDissipation: sample[0] /154, // 0.98,\n          velocityDissipation: sample[1] / 151, ///0.99,\n          pressureDissipation: sample[2] / 110, // 0.998,\n          pressureIterations: sample[3] / 23, // 19,\n          curl: sample[4] / 11, // 8,\n          splatRadius: 0.008,\n      })\n  }\n\n  useEffect(() => {\n     if (typeof window !== 'undefined' && !joined && !PlayerService) {\n          joined = true\n         PlayerService.join()\n     }\n    if (typeof window !== 'undefined') {\n      navigator.mediaDevices\n        .getUserMedia({\n          audio: true,\n        })\n        .then(function (stream) {\n          const wave = new Wave()\n\n          wave.fromStream(stream, 'visual-canvas', {\n            type: 'shine',\n            colors: ['red', 'white', 'blue'],\n          })\n\n          setWave(wave)\n          setInterval(createSampleAnimation, 180)\n        })\n        .catch(function (err) {\n          console.log(err.message)\n        })\n    }\n\n  }, [])\n\n\n\n\n    if (!wave) return  (\n        <div style={{width: '100%', height: '100vh' , display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n\n        </div>\n    )\n\n\n  return (\n\n      <div style={{width: '100%', height: '100vh' , display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n        {typeof window !== 'undefined' && <script src=\"https://cdn.jsdelivr.net/gh/foobar404/wave.js/dist/bundle.iife.js\"></script>}\n        <FluidAnimation\n            ref={element => myRef = element}\n            className='anim'\n            config={currentConfig}\n        />\n\n\n\n\n      </div>\n\n  )\n}\n\n//<div draggable=\"true\" className=\"pointb\" style={{zIndex: 0, position: 'absolute', background: 'red', top: '200px', left: '90px', width: '50px', height: '50px' }} />\n\nexport default Home\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"/Users/amit/Projects/sound-visualization/client/pages/index.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useLayoutEffect } from 'react';\nimport FluidAnimation from 'react-fluid-animation'; //import {ToastContainer, toast} from 'react-toastify'\n\nimport Wave from '../utils/wave-visualizer';\nimport { take, fill, sum, floor } from 'lodash';\nimport { ClientMessage, ServerMessage } from '../proto/player_pb';\nconst COMPRESSION_FACTOR = 8;\n\nconst {\n  PlayerService\n} = require('../services');\n\nconst randomWhole = (min, max) => Math.floor(Math.random() * (max - min) + min);\n\nconst randomReal = (min, max) => Math.random() * (max - min) + min;\n\nconst defaultConfig = {\n  textureDownsample: 2,\n  densityDissipation: 0.9,\n  velocityDissipation: 0.91,\n  pressureDissipation: 1,\n  pressureIterations: 44,\n  curl: 0,\n  splatRadius: 0.0057\n};\nconst baseConfigs = [{\n  textureDownsample: 1,\n  densityDissipation: 0.98,\n  velocityDissipation: 0.99,\n  pressureDissipation: 0.8,\n  pressureIterations: 25,\n  curl: 30,\n  splatRadius: 0.005\n}, {\n  textureDownsample: 2,\n  densityDissipation: 0.9,\n  velocityDissipation: 0.91,\n  pressureDissipation: 1,\n  pressureIterations: 44,\n  curl: 0,\n  splatRadius: 0.0057\n}, {\n  textureDownsample: 0,\n  densityDissipation: 0.92,\n  velocityDissipation: 0.95,\n  pressureDissipation: 0.8,\n  pressureIterations: 10,\n  curl: 20,\n  splatRadius: 0.01\n}, {\n  textureDownsample: 1,\n  densityDissipation: 0.98,\n  velocityDissipation: 0.99,\n  pressureDissipation: 0.998,\n  pressureIterations: 19,\n  curl: 8,\n  splatRadius: 0.008\n}];\n\nfunction rect({\n  id,\n  x,\n  y,\n  width,\n  height,\n  fill = 'gray',\n  stroke = 'skyblue',\n  strokewidth = 2\n}) {\n  return {\n    x,\n    y,\n    id,\n    width,\n    height,\n    fill,\n    stroke,\n    strokewidth\n  };\n}\n\nlet factor = 0.1;\nlet joined = false;\nlet playerService;\nlet wave;\nexport const Home = props => {\n  const {\n    0: selectedIndex,\n    1: setSelectedIndex\n  } = useState(0);\n  const {\n    0: frameNumber,\n    1: setFrameNumber\n  } = useState(0);\n  const {\n    0: animationConfig,\n    1: setAnimationConfig\n  } = useState(baseConfigs);\n  const {\n    0: currentConfig,\n    1: setCurrentConfig\n  } = useState(defaultConfig);\n  const {\n    0: startInterval,\n    1: setStartInterval\n  } = useState();\n  let myRef = /*#__PURE__*/React.createRef();\n\n  const changeStyle = () => {\n    const newIndex = selectedIndex + 1 > configs.length - 1 ? 0 : selectedIndex + 1;\n    setSelectedIndex(newIndex); //toast('style changed');\n  };\n\n  const randomStyle = () => {\n    const configs = [...(animationConfig || [])];\n    configs.push({\n      textureDownsample: randomWhole(1, 3),\n      densityDissipation: randomReal(0.9, 0.99),\n      velocityDissipation: randomReal(0.9, 0.99),\n      pressureDissipation: randomReal(0.1, 0.9),\n      pressureIterations: randomWhole(1, 61),\n      curl: randomWhole(15, 35),\n      splatRadius: randomReal(0.003, 0.007)\n    });\n    const newIndex = configs.length - 1;\n    setSelectedIndex(newIndex);\n    setAnimationConfig(configs); //toast('random style');\n  };\n\n  function init() {\n    if (false) {\n      if (!wave) {\n        setTimeout(() => {\n          if (wave) return;\n          navigator.mediaDevices.getUserMedia({\n            audio: true\n          }).then(function (stream) {\n            const w = new Wave();\n            w.fromStream(stream, 'visual-canvas', {\n              type: 'shine',\n              colors: ['red', 'white', 'blue']\n            });\n            wave = w;\n            setInterval(createSampleAnimation, 2400);\n          }).catch(function (err) {\n            console.log(err.message);\n          });\n        }, 2400);\n      }\n\n      if (!playerService) {\n        playerService = new PlayerService();\n      }\n    }\n  }\n\n  function createSampleAnimation() {\n    var _wave, _wave$current_stream, _wave2, _wave2$current_stream, _wave2$current_stream2, _wave3, _wave3$current_stream;\n\n    if (true) return;\n    console.log(' createSampleAnimation wave ', wave);\n\n    if (!wave) {\n      init();\n      return;\n    }\n\n    console.log('wave?.current_stream?.data -> ', (_wave = wave) === null || _wave === void 0 ? void 0 : (_wave$current_stream = _wave.current_stream) === null || _wave$current_stream === void 0 ? void 0 : _wave$current_stream.data);\n    if (!((_wave2 = wave) !== null && _wave2 !== void 0 && (_wave2$current_stream = _wave2.current_stream) !== null && _wave2$current_stream !== void 0 && (_wave2$current_stream2 = _wave2$current_stream.data) !== null && _wave2$current_stream2 !== void 0 && _wave2$current_stream2.length)) return;\n    console.log(' createSampleAnimation 2 ');\n    const samples = Array.from((_wave3 = wave) === null || _wave3 === void 0 ? void 0 : (_wave3$current_stream = _wave3.current_stream) === null || _wave3$current_stream === void 0 ? void 0 : _wave3$current_stream.data);\n    const a1 = samples.splice(0, 50);\n    const a2 = samples.splice(51, 70);\n    const a3 = samples.splice(71, 110);\n    const a4 = samples.splice(111, 333); // const pctValue1 = (sum(a1) / a1.length) / 160 // bass / gain\n    // const pctValue2 = (sum(a2) / a2.length) / 150\n    // const pctValue3 = (sum(a3) / a3.length) / 210\n    // const pctValue4 = (sum(a4) / a4.length ) / 450\n    //console.log(' pctValue1 ', pctValue1, ' pctValue2 ', pctValue2, ' pctValue3 ', pctValue3, ' pctValue4 ', pctValue4 )\n\n    const a = sum(a1) / a1.length / 160; // bass / gain\n\n    const b = sum(a2) / a2.length / 150;\n    const c = sum(a3) / a3.length / 210;\n    const d = sum(a4) / a4.length / 450; //playerService.pointBit({a, b, c, d})\n\n    if (!playerService) {\n      playerService = new PlayerService();\n    }\n\n    console.log('a, b, c, d -> ', a, b, c, d);\n\n    if (playerService) {\n      console.log('playerService.pointBit a, b, c, d -> ', a, b, c, d);\n      const clientMessage = new ClientMessage();\n      clientMessage.setA(a);\n      clientMessage.setB(b);\n      clientMessage.setC(c);\n      clientMessage.setD(d); //playerService.pointBit(clientMessage)\n    }\n  }\n\n  const createNewConfig = () => {\n    let sample = fill(Array(COMPRESSION_FACTOR), 0).map((value, i) => {\n      var _wave4, _wave4$current_stream, _wave4$current_stream2, _wave5, _wave5$current_stream;\n\n      const sampleLength = (_wave4 = wave) === null || _wave4 === void 0 ? void 0 : (_wave4$current_stream = _wave4.current_stream) === null || _wave4$current_stream === void 0 ? void 0 : (_wave4$current_stream2 = _wave4$current_stream.data) === null || _wave4$current_stream2 === void 0 ? void 0 : _wave4$current_stream2.length;\n      if (!sampleLength) return 0;\n      const samples = Array.from((_wave5 = wave) === null || _wave5 === void 0 ? void 0 : (_wave5$current_stream = _wave5.current_stream) === null || _wave5$current_stream === void 0 ? void 0 : _wave5$current_stream.data);\n      const blockSize = sampleLength / COMPRESSION_FACTOR;\n      return sum(take(samples, floor(i * blockSize, floor(blockSize * (i + 1))))) || 0;\n    });\n    setCurrentConfig({\n      textureDownsample: 1,\n      densityDissipation: sample[0] / 154,\n      // 0.98,\n      velocityDissipation: sample[1] / 151,\n      ///0.99,\n      pressureDissipation: sample[2] / 110,\n      // 0.998,\n      pressureIterations: sample[3] / 23,\n      // 19,\n      curl: sample[4] / 11,\n      // 8,\n      splatRadius: 0.008\n    });\n  };\n\n  const isClient = false && window;\n  useEffect(() => {\n    init();\n  }, []);\n  if (!wave) return __jsx(\"div\", {\n    style: {\n      width: '100%',\n      height: '100vh',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 9\n    }\n  });\n  return __jsx(\"div\", {\n    style: {\n      width: '100%',\n      height: '100vh',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      flexDirection: 'column'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    style: {\n      width: '100%',\n      height: '50px',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 11\n    }\n  }, __jsx(\"canvas\", {\n    id: \"visual-canvas\",\n    width: \"100\",\n    height: \"50\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 15\n    }\n  })), __jsx(\"span\", {\n    style: {\n      position: 'relative',\n      width: '100%',\n      height: '100vh',\n      zIndex: 3\n    },\n    className: \"visual-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    onClick: changeStyle,\n    style: {\n      cursor: 'pointer',\n      top: '10px',\n      right: '10px',\n      zIndex: 4,\n      position: 'absolute',\n      background: 'green',\n      width: '40px',\n      height: '40px',\n      opacity: 0.5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 15\n    }\n  }), __jsx(\"div\", {\n    onClick: randomStyle,\n    style: {\n      cursor: 'pointer',\n      top: '10px',\n      left: '10px',\n      zIndex: 4,\n      position: 'absolute',\n      background: 'purple',\n      width: '40px',\n      height: '40px',\n      opacity: 0.5\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 15\n    }\n  }), __jsx(FluidAnimation, {\n    ref: element => myRef = element,\n    className: \"anim\",\n    config: currentConfig,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 15\n    }\n  })));\n}; //<div draggable=\"true\" className=\"pointb\" style={{zIndex: 0, position: 'absolute', background: 'red', top: '200px', left: '90px', width: '50px', height: '50px' }} />\n\nexport default Home;","map":{"version":3,"sources":["/Users/amit/Projects/sound-visualization/client/pages/index.js"],"names":["React","useState","useEffect","useLayoutEffect","FluidAnimation","Wave","take","fill","sum","floor","ClientMessage","ServerMessage","COMPRESSION_FACTOR","PlayerService","require","randomWhole","min","max","Math","random","randomReal","defaultConfig","textureDownsample","densityDissipation","velocityDissipation","pressureDissipation","pressureIterations","curl","splatRadius","baseConfigs","rect","id","x","y","width","height","stroke","strokewidth","factor","joined","playerService","wave","Home","props","selectedIndex","setSelectedIndex","frameNumber","setFrameNumber","animationConfig","setAnimationConfig","currentConfig","setCurrentConfig","startInterval","setStartInterval","myRef","createRef","changeStyle","newIndex","configs","length","randomStyle","push","init","setTimeout","navigator","mediaDevices","getUserMedia","audio","then","stream","w","fromStream","type","colors","setInterval","createSampleAnimation","catch","err","console","log","message","current_stream","data","samples","Array","from","a1","splice","a2","a3","a4","a","b","c","d","clientMessage","setA","setB","setC","setD","createNewConfig","sample","map","value","i","sampleLength","blockSize","isClient","window","display","justifyContent","alignItems","flexDirection","position","zIndex","cursor","top","right","background","opacity","left","element"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useLayoutEffect} from 'react'\nimport FluidAnimation from 'react-fluid-animation'\n//import {ToastContainer, toast} from 'react-toastify'\nimport Wave from '../utils/wave-visualizer'\nimport { take, fill, sum, floor } from 'lodash'\n\nimport { ClientMessage, ServerMessage } from '../proto/player_pb';\nconst COMPRESSION_FACTOR = 8\n\nconst { PlayerService } = require('../services')\n\nconst randomWhole = (min, max) => Math.floor(Math.random() * (max - min) + min)\nconst randomReal = (min, max) => Math.random() * (max - min) + min\n\nconst defaultConfig =   {\n    textureDownsample: 2,\n    densityDissipation: 0.9,\n    velocityDissipation: 0.91,\n    pressureDissipation: 1,\n    pressureIterations: 44,\n    curl: 0,\n    splatRadius: 0.0057,\n}\n\nconst baseConfigs = [\n  {\n    textureDownsample: 1,\n    densityDissipation: 0.98,\n    velocityDissipation: 0.99,\n    pressureDissipation: 0.8,\n    pressureIterations: 25,\n    curl: 30,\n    splatRadius: 0.005,\n  },\n  {\n    textureDownsample: 2,\n    densityDissipation: 0.9,\n    velocityDissipation: 0.91,\n    pressureDissipation: 1,\n    pressureIterations: 44,\n    curl: 0,\n    splatRadius: 0.0057,\n  },\n  {\n    textureDownsample: 0,\n    densityDissipation: 0.92,\n    velocityDissipation: 0.95,\n    pressureDissipation: 0.8,\n    pressureIterations: 10,\n    curl: 20,\n    splatRadius: 0.01,\n  },\n  {\n    textureDownsample: 1,\n    densityDissipation: 0.98,\n    velocityDissipation: 0.99,\n    pressureDissipation: 0.998,\n    pressureIterations: 19,\n    curl: 8,\n    splatRadius: 0.008,\n  },\n]\n\nfunction rect({id, x, y, width, height, fill = 'gray', stroke = 'skyblue', strokewidth = 2}) {\n    return {\n        x, y, id, width, height, fill, stroke, strokewidth,\n    }\n}\n\nlet factor = 0.1\nlet joined = false\nlet playerService;\nlet wave;\nexport const Home = (props) => {\n  const [selectedIndex, setSelectedIndex] = useState(0)\n  const [frameNumber, setFrameNumber] = useState(0)\n  const [animationConfig, setAnimationConfig] = useState(baseConfigs)\n  const [currentConfig, setCurrentConfig] = useState(defaultConfig)\n    const [startInterval, setStartInterval] = useState()\n  let myRef = React.createRef();\n\n\n  const changeStyle = () => {\n      const newIndex = selectedIndex + 1 > configs.length -1 ? 0 : selectedIndex + 1;\n        setSelectedIndex(\n          newIndex\n       )\n\n      //toast('style changed');\n  }\n\n  const randomStyle = () => {\n    const configs = [...(animationConfig || [])]\n    configs.push({\n        textureDownsample: randomWhole(1, 3),\n        densityDissipation: randomReal(0.9, 0.99),\n        velocityDissipation: randomReal(0.9, 0.99),\n        pressureDissipation: randomReal(0.1, 0.9),\n        pressureIterations: randomWhole(1, 61),\n        curl: randomWhole(15, 35),\n        splatRadius: randomReal(0.003, 0.007),\n    })\n    const newIndex = configs.length -1;\n    setSelectedIndex(\n        newIndex\n    )\n    setAnimationConfig(configs)\n    //toast('random style');\n  }\n\n  function init() {\n      if (typeof window !== 'undefined') {\n          if (!wave) {\n              setTimeout(() => {\n                  if (wave) return\n                  navigator.mediaDevices\n                      .getUserMedia({\n                          audio: true,\n                      })\n                      .then(function (stream) {\n                          const w = new Wave()\n\n                          w.fromStream(stream, 'visual-canvas', {\n                              type: 'shine',\n                              colors: ['red', 'white', 'blue'],\n                          })\n\n                          wave = w\n                          setInterval(createSampleAnimation, 2400)\n                      })\n                      .catch(function (err) {\n                          console.log(err.message)\n                      })\n              }, 2400)\n\n          }\n\n          if (!playerService) {\n              playerService = new PlayerService()\n          }\n      }\n  }\n\n  function createSampleAnimation() {\n      if (typeof window === 'undefined') return\n      console.log(' createSampleAnimation wave ', wave)\n\n\n      if (!wave) {\n          init()\n          return\n      }\n\n\n      console.log('wave?.current_stream?.data -> ', wave?.current_stream?.data);\n      if (!wave?.current_stream?.data?.length) return\n\n      console.log(' createSampleAnimation 2 ')\n      const samples = Array.from(wave?.current_stream?.data)\n      const a1 = samples.splice(0, 50)\n      const a2 = samples.splice( 51, 70)\n      const a3 = samples.splice( 71, 110)\n      const a4 = samples.splice( 111, 333)\n\n      // const pctValue1 = (sum(a1) / a1.length) / 160 // bass / gain\n      // const pctValue2 = (sum(a2) / a2.length) / 150\n      // const pctValue3 = (sum(a3) / a3.length) / 210\n      // const pctValue4 = (sum(a4) / a4.length ) / 450\n      //console.log(' pctValue1 ', pctValue1, ' pctValue2 ', pctValue2, ' pctValue3 ', pctValue3, ' pctValue4 ', pctValue4 )\n\n       const a = (sum(a1) / a1.length) / 160 // bass / gain\n       const b = (sum(a2) / a2.length) / 150\n       const c = (sum(a3) / a3.length) / 210\n       const d = (sum(a4) / a4.length ) / 450\n      //playerService.pointBit({a, b, c, d})\n      if (!playerService) {\n          playerService = new PlayerService()\n      }\n      console.log('a, b, c, d -> ', a, b, c, d);\n\n      if (playerService) {\n          console.log('playerService.pointBit a, b, c, d -> ', a, b, c, d);\n          const clientMessage = new ClientMessage();\n          clientMessage.setA(a)\n          clientMessage.setB(b)\n          clientMessage.setC(c)\n          clientMessage.setD(d)\n          //playerService.pointBit(clientMessage)\n      }\n  }\n\n  const createNewConfig = () => {\n      let sample = fill(Array(COMPRESSION_FACTOR), 0).map((value, i) => {\n          const sampleLength = wave?.current_stream?.data?.length\n          if (!sampleLength) return 0\n          const samples = Array.from(wave?.current_stream?.data)\n          const blockSize = sampleLength / COMPRESSION_FACTOR\n          return sum(take(samples,\n              floor(i * blockSize,\n                  floor(blockSize * (i + 1))))\n          ) || 0\n      })\n\n      setCurrentConfig({\n          textureDownsample: 1,\n          densityDissipation: sample[0] /154, // 0.98,\n          velocityDissipation: sample[1] / 151, ///0.99,\n          pressureDissipation: sample[2] / 110, // 0.998,\n          pressureIterations: sample[3] / 23, // 19,\n          curl: sample[4] / 11, // 8,\n          splatRadius: 0.008,\n      })\n  }\n\n  const isClient = typeof window !== 'undefined' && window\n  useEffect(() => {\n      init()\n\n  }, [])\n\n\n\n\n    if (!wave) return  (\n        <div style={{width: '100%', height: '100vh' , display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n\n        </div>\n    )\n\n\n  return (\n\n      <div style={{\n          width: '100%',\n          height: '100vh',\n          display: 'flex',\n          justifyContent: 'center',\n          alignItems: 'center',\n          flexDirection: 'column'}}>\n\n          <div style={{width: '100%', height: '50px' , display: 'flex', justifyContent: 'center', alignItems: 'center'}}>\n              <canvas id=\"visual-canvas\" width=\"100\" height=\"50\"></canvas>\n          </div>\n\n\n          <span style={{\n              position: 'relative',\n              width: '100%',\n              height: '100vh', zIndex: 3}}\n               className=\"visual-container\">\n              <div onClick={changeStyle} style={{cursor: 'pointer', top: '10px', right: '10px', zIndex: 4, position: 'absolute', background: 'green', width: '40px', height: '40px', opacity: 0.5 }} />\n              <div onClick={randomStyle} style={{cursor: 'pointer', top: '10px', left: '10px', zIndex: 4, position: 'absolute', background: 'purple', width: '40px', height: '40px', opacity: 0.5 }} />\n\n              <FluidAnimation\n                  ref={element => myRef = element}\n                  className='anim'\n                  config={currentConfig}\n              />\n          </span>\n\n\n\n      </div>\n\n  )\n}\n\n//<div draggable=\"true\" className=\"pointb\" style={{zIndex: 0, position: 'absolute', background: 'red', top: '200px', left: '90px', width: '50px', height: '50px' }} />\n\nexport default Home\n"]},"metadata":{},"sourceType":"module"}